<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Law and Contract - SEEDARCHIVE</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: white;
            padding: 20px 5px;
            min-height: 100vh;
            overflow-y: auto;
            padding-top: 60px;
        }
        
        a, button, [onclick], [role="button"], .clickable, *[cursor="pointer"], *[style*="cursor: pointer"] {
            cursor: pointer !important;
        }

        .top-tab {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: white;
            border-bottom: 1px solid black;
            z-index: 1000;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .scrolling-text-container {
            display: flex;
            white-space: nowrap;
            animation: scrollText 30s linear infinite;
            position: absolute;
            left: 0;
            will-change: transform;
        }

        .scrolling-text {
            font-size: 16px;
            color: black;
            padding-right: 50px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        @keyframes scrollText {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }

        .main-layout {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .step-layout {
            display: block;
            flex: 1;
            max-width: calc(100% - 215px);
            margin-bottom: 100px;
        }

        .step-section {
            margin-bottom: 40px;
            display: flex;
            flex-direction: column;
        }

        .step-section .step-title {
            margin-top: 0;
            margin-bottom: 20px;
        }

        .step-image {
            width: 100%;
            border: 1px solid black;
            background: white;
            margin-bottom: 20px;
            aspect-ratio: 1;
            max-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible;
            padding: 20px;
            box-sizing: border-box;
        }

        .step-image img,
        .step-image svg {
            width: calc(100% - 40px);
            height: calc(100% - 40px);
            object-fit: contain;
        }

        .step-image.materials-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            padding: 30px;
            overflow: hidden;
            min-height: 0;
        }

        .step-image.materials-grid .material-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }

        .step-image.materials-grid .material-item svg {
            width: 80%;
            height: 80%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .step-image.materials-grid .material-item:hover svg {
            transform: scale(1.15);
        }

        .step-image.materials-grid .material-item .material-name {
            font-size: 14px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            text-align: center;
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            pointer-events: none;
        }

        .step-image.materials-grid .material-item:hover .material-name {
            opacity: 1;
        }

        /* 确保materials section的SVG都是实线 */
        .step-image.materials-grid svg * {
            stroke-dasharray: none !important;
            stroke-dashoffset: 0 !important;
        }

        /* 确保所有step-image中的SVG都是实线 */
        .step-image svg * {
            stroke-dasharray: none !important;
            stroke-dashoffset: 0 !important;
        }

        /* Introduction 部分的 SVG stroke-width 设置为 1px */
        #introduction .step-image svg * {
            stroke-width: 1px !important;
        }

        .step-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .step-content {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .document-box {
            width: 100%;
            border: 1px solid black;
            background: white;
            padding: 30px;
            box-sizing: border-box;
            margin-bottom: 20px;
        }

        .document-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .document-content {
            font-size: 16px;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .contract-template {
            border: 1px solid black;
            padding: 30px;
            margin-bottom: 20px;
            background: white;
        }

        .contract-header {
            text-align: center;
            margin-bottom: 30px;
            font-weight: bold;
            font-size: 18px;
            text-transform: uppercase;
        }

        .contract-section {
            margin-bottom: 25px;
        }

        .contract-section-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .contract-text {
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        /* Principles step section */
        .principles-box {
            width: 100%;
            border: 1px solid black;
            background: white;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
        }

        .principles-steps {
            width: 200px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex-shrink: 0;
        }

        .principles-step {
            cursor: pointer;
            padding: 8px;
            transition: all 0.3s ease;
        }

        .principles-step:hover {
            font-weight: bold;
        }

        .principles-step.active {
            font-weight: bold;
        }

        .principles-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .principles-image {
            width: 100%;
            aspect-ratio: 1;
            max-height: 50vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            margin-bottom: 20px;
            overflow: visible;
            cursor: pointer;
        }

        .principles-image svg {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none;
        }

        .principles-image svg.active {
            display: block;
        }

        /* 确保所有SVG都是实线 */
        #materials .principles-image svg * {
            stroke-dasharray: none !important;
            stroke-dashoffset: 0 !important;
        }

        #basic-principles .principles-image svg * {
            stroke-dasharray: none !important;
            stroke-dashoffset: 0 !important;
        }

        #resource-contract .principles-image svg * {
            stroke-dasharray: none !important;
            stroke-dashoffset: 0 !important;
        }

        .principles-description {
            font-size: 18px;
            line-height: 1.6;
            text-align: left;
        }

        /* Step navigation panel */
        .step-navigation {
            display: block;
            position: fixed;
            top: 80px;
            right: 50px;
            width: 200px;
            padding: 20px;
            background: white;
            border: 1px solid black;
            box-sizing: border-box;
            z-index: 100;
        }

        .step-nav-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            cursor: pointer;
            padding: 5px;
        }

        .step-nav-item:hover {
            font-weight: bold;
        }

        .step-nav-item.active {
            font-weight: bold;
        }

        .step-nav-item .legend-text {
            font-size: 12px;
            color: black;
            white-space: nowrap;
        }

        .step-nav-item .legend-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
            box-sizing: border-box;
            background: black;
        }

        .step-nav-item.active .legend-dot {
            border: 1px solid black;
            background: white !important;
        }

        /* Close button for back */
        .step-nav-close {
            position: relative;
            width: 30px;
            height: 30px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .step-nav-close::before,
        .step-nav-close::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 1px;
            background: black;
        }

        .step-nav-close::before {
            transform: rotate(45deg);
        }

        .step-nav-close::after {
            transform: rotate(-45deg);
        }

        /* Print button */
        .print-icon {
            display: none;
            width: 18px;
            height: 18px;
            stroke: black;
        }

        /* Hide borders when printing */
        .print-mode .editable-field,
        .print-mode .editable-text {
            border-bottom: none !important;
        }

        .print-mode span[style*="border-bottom"] {
            border-bottom: none !important;
        }

        .contract-template {
            position: relative;
            border: 1px solid black;
            background: white;
            min-height: 80px;
            height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: min-height 0s ease;
            overflow: hidden;
            box-sizing: border-box;
        }

        .contract-template.expanded {
            min-height: auto;
            display: block;
        }

        .contract-header-box {
            padding: 10px 15px;
            font-size: 18px;
            font-weight: bold;
            color: black;
            text-align: center;
            position: relative;
            z-index: 2;
            transition: opacity 0s ease, visibility 0s ease;
            text-transform: uppercase;
            cursor: pointer;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .contract-template.expanded .contract-header-box {
            opacity: 0 !important;
            visibility: hidden !important;
            position: absolute !important;
            width: 0 !important;
            height: 0 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
            font-size: 0 !important;
            line-height: 0 !important;
        }

        .contract-box-button {
            position: absolute;
            top: 8px;
            left: 8px;
            width: 30px;
            height: 30px;
            background: black;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .contract-box-button:hover {
            background: white;
            border: 1px solid black;
        }

        .contract-box-button .print-icon {
            display: none;
            width: 18px;
            height: 18px;
            stroke: black;
        }

        .contract-box-button:hover .print-icon {
            display: block;
        }

        .contract-content {
            position: absolute;
            top: 10px;
            left: 10px;
            width: calc(100% - 20px);
            height: calc(100% - 20px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0s ease, visibility 0s ease;
            z-index: 1;
            overflow: hidden;
        }

        .contract-template.expanded .contract-content {
            opacity: 1;
            visibility: visible;
            position: relative;
            top: 0;
            left: 0;
            width: 100%;
            height: auto;
            padding: 20px;
        }


        /* Editable fields */
        .editable-field {
            display: inline-block;
            min-width: 100px;
            border-bottom: 1px solid #000;
            padding: 2px 5px;
            cursor: text;
            background: transparent;
            outline: none;
            min-height: 1em;
        }

        .editable-field:empty::before {
            content: '';
            display: inline-block;
        }

        .editable-field:focus {
            background: #f0f0f0;
        }

        /* Editable text content */
        .editable-text {
            display: inline-block;
            min-width: 200px;
            border-bottom: 1px solid #000;
            padding: 2px 5px;
            cursor: text;
            background: transparent;
            outline: none;
            min-height: 1em;
        }

        .editable-text:empty::before {
            content: '';
            display: inline-block;
        }

        .editable-text:focus {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="top-tab">
        <div class="scrolling-text-container">
            <div class="scrolling-text">@SEEDARCHIVEWEB  FIND YOUR SEED</div>
            <div class="scrolling-text">@SEEDARCHIVEWEB  FIND YOUR SEED</div>
            <div class="scrolling-text">@SEEDARCHIVEWEB  FIND YOUR SEED</div>
            <div class="scrolling-text">@SEEDARCHIVEWEB  FIND YOUR SEED</div>
            <div class="scrolling-text">@SEEDARCHIVEWEB  FIND YOUR SEED</div>
            <div class="scrolling-text">@SEEDARCHIVEWEB  FIND YOUR SEED</div>
        </div>
    </div>
    <div class="container">
        <div class="main-layout">
            <!-- Step-by-step Layout -->
            <div class="step-layout" id="step-layout">
                <div class="step-section" id="introduction">
                    <div class="step-image">
                        <svg width="288" height="288" viewBox="0 0 288 288" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:1px;}</style>
                            </defs>
                            <polygon class="cls-1" points="226.89 257.33 178.05 257.33 121.81 257.33 93.9 257.33 59.79 257.33 59.79 22.59 226.89 22.59 226.89 257.33"/>
                            <path d="M121.06,28.47h2.17v15.02h7.2v1.82h-9.37v-16.85Z"/>
                            <path d="M135.58,40.02l-1.75,5.3h-2.25l5.72-16.85h2.62l5.75,16.85h-2.32l-1.8-5.3h-5.97ZM141.11,38.32l-1.65-4.85c-.38-1.1-.62-2.1-.88-3.07h-.05c-.25,1-.53,2.02-.85,3.05l-1.65,4.87h5.07Z"/>
                            <path d="M149.58,45.32l-4.27-16.85h2.3l2,8.52c.5,2.1.95,4.2,1.25,5.82h.05c.27-1.67.8-3.67,1.38-5.85l2.25-8.5h2.27l2.05,8.55c.47,2,.92,4,1.17,5.77h.05c.35-1.85.82-3.72,1.35-5.82l2.22-8.5h2.22l-4.77,16.85h-2.27l-2.12-8.77c-.53-2.15-.88-3.8-1.1-5.5h-.05c-.3,1.67-.67,3.32-1.3,5.5l-2.4,8.77h-2.27Z"/>
                            <line class="cls-1" x1="66.85" y1="60.18" x2="219.83" y2="60.18"/>
                            <line class="cls-1" x1="66.85" y1="68.39" x2="219.83" y2="68.39"/>
                            <line class="cls-1" x1="66.85" y1="77.35" x2="219.83" y2="77.35"/>
                            <line class="cls-1" x1="66.85" y1="85.57" x2="219.83" y2="85.57"/>
                            <line class="cls-1" x1="66.85" y1="94.47" x2="219.83" y2="94.47"/>
                            <line class="cls-1" x1="66.85" y1="102.69" x2="219.83" y2="102.69"/>
                            <line class="cls-1" x1="66.85" y1="111.64" x2="219.83" y2="111.64"/>
                            <line class="cls-1" x1="66.85" y1="119.86" x2="219.83" y2="119.86"/>
                            <line class="cls-1" x1="66.85" y1="128.74" x2="219.83" y2="128.74"/>
                            <line class="cls-1" x1="66.85" y1="136.95" x2="219.83" y2="136.95"/>
                            <line class="cls-1" x1="66.85" y1="145.91" x2="219.83" y2="145.91"/>
                            <line class="cls-1" x1="66.85" y1="154.13" x2="219.83" y2="154.13"/>
                            <line class="cls-1" x1="66.85" y1="163.03" x2="219.83" y2="163.03"/>
                            <line class="cls-1" x1="66.85" y1="171.25" x2="219.83" y2="171.25"/>
                            <line class="cls-1" x1="66.85" y1="180.2" x2="219.83" y2="180.2"/>
                            <line class="cls-1" x1="66.85" y1="188.42" x2="219.83" y2="188.42"/>
                            <line class="cls-1" x1="66.85" y1="197.06" x2="219.83" y2="197.06"/>
                            <line class="cls-1" x1="66.85" y1="205.96" x2="219.83" y2="205.96"/>
                            <line class="cls-1" x1="66.85" y1="214.18" x2="219.83" y2="214.18"/>
                            <line class="cls-1" x1="66.85" y1="223.14" x2="219.83" y2="223.14"/>
                            <line class="cls-1 line-short" x1="66.85" y1="231.35" x2="158.74" y2="231.35"/>
                        </svg>
                    </div>
                    <div class="step-title">INTRODUCTION</div>
                    <div class="step-content">
                        In a post-apocalyptic world where existing legal systems have collapsed, establishing basic legal frameworks and contractual agreements becomes essential for community survival and rebuilding. This section provides fundamental legal principles, contract templates, and governance structures that can be adapted to various community sizes and situations. These documents are designed to be simple, enforceable, and focused on fairness, resource allocation, and conflict resolution.
                    </div>
                </div>

                <div class="step-section" id="materials">
                    <div class="principles-box">
                        <div class="principles-steps">
                            <div class="principles-step active" onclick="showMaterialsStep(1, this)">STEP 1</div>
                            <div class="principles-step" onclick="showMaterialsStep(2, this)">STEP 2</div>
                            <div class="principles-step" onclick="showMaterialsStep(3, this)">STEP 3</div>
                            <div class="principles-step" onclick="showMaterialsStep(4, this)">STEP 4</div>
                            <div class="principles-step" onclick="showMaterialsStep(5, this)">STEP 5</div>
                        </div>
                        <div class="principles-content">
                            <div class="principles-image">
                                <svg id="material-step-1" class="active" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:#fff;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><polygon class="cls-1" points="518.81 629.65 482.45 618.91 440.22 629.65 386.65 619.94 339.27 629.65 290.85 618.91 245.53 629.65 203.29 617.88 127.06 648.78 126.69 629.65 126.69 74.38 518.81 74.38 518.81 629.65"/><polygon class="cls-1" points="587.23 247.06 579.23 218.59 571.22 247.06 570.85 247.06 570.85 545.57 587.61 545.57 587.61 247.06 587.23 247.06"/></svg>
                                <svg id="material-step-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:#fff;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><polygon class="cls-1" points="618.01 259.76 366.89 77.5 115.78 259.76 147.39 259.76 147.39 620.13 586.4 620.13 586.4 259.76 618.01 259.76"/></svg>
                                <svg id="material-step-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:#fff;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><circle class="cls-1" cx="315.03" cy="220.86" r="65.18"/><path class="cls-1" d="M439.45,615.79c-1.17-164.97-56.42-297.84-124.43-297.84s-123.26,132.86-124.43,297.84h248.85Z"/><circle class="cls-1" cx="406.11" cy="220.86" r="65.18"/><path class="cls-1" d="M530.54,615.79c-1.17-164.97-56.42-297.84-124.43-297.84s-123.26,132.86-124.43,297.84h248.85Z"/></svg>
                                <svg id="material-step-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:#fff;}.cls-1,.cls-2{stroke:#000;stroke-miterlimit:10;stroke-width:4px;}.cls-2{fill:none;}</style></defs><circle class="cls-1" cx="352.22" cy="365.98" r="205.87"/><circle class="cls-1" cx="352.22" cy="365.98" r="175.66"/><path class="cls-2" d="M246.27,278.56c-1.38-1.09-3.92-.31-3.74,1.15,1.12,9.38,5.69,27.2,25.02,43.01,18.62,15.23,46.29,24.79,60.73,24.7,1.57,0,5.62-.15,10.06,1.34,7.37,2.48,10.9,7.81,14.16,12.73,3.22,4.86,3.64,7.92,3.74,8.76.28,2.43-.22,3.42-.36,6.13-.27,5.41,1.45,7.19,1.8,10.86.5,5.35-2.7,6.47-7.99,17.6-1.46,3.08-3.4,7.21-4.9,12.65-2.44,8.86-2.37,16.44-2.32,20.35.09,6.65.86,6.17.52,10.45-.24,2.92.75,11.8-5.67,17.42-5.31,4.65-9.12,9.75-8.45,10.59.09.11.25.13.38.13h54.48c-6.02-6.61-10.06-12.76-12.67-17.25-2.39-4.11-14.99-25.8-11.97-41.7.31-1.65,1.81-8.57,4.51-17.05.52-1.63.97-2.96,1.26-3.8,0,0,.77-2.94.94-5.87.32-5.34-2.63-6.95-3.08-12.43-.39-4.72,1.36-8.86,4.75-16.85.53-1.26.81-1.91,1.29-2.81,1.43-2.71,4.02-6.5,8.76-9.92,4-2.88,6.64-3.42,18.04-7.73,12.32-4.65,18.48-6.97,21.91-8.98,10.58-6.19,15.49-13.82,18.04-17.79,4.53-7.03,6.11-13.35,6.7-16.32,1.19-5.99.04-7.07,1.55-13.57,1.93-8.3,5.17-12.45,3.6-13.11-1.09-.46-3.35,1.26-13.65,8.35-9.76,6.72-11.68,7.9-12.89,8.62-3.39,2.02-8.73,5.21-16.24,8.07-11.15,4.25-14.44,2.95-22.17,7.15-1.06.58-2.01,1.15-2.9,1.74-.78.52-3.85,2.56-6.9,5.59-3.04,3.03-6.28,6.25-8.24,11.56-2.18,5.89-1.72,11.45-1.29,13.92.54,3.12,1,4.89,1,4.89.73,2.78,1.21,3.59,1.35,5.59.13,1.91-.16,3.4-.31,4.13-.44,2.13-1.08,3.14-1.74,4.77-2.01,4.95-1.08,8.22-2.09,8.31-.57.05-2.31-2.6-4.71-7.35-1.3-2.58-.44-1.86-3.03-5.49-1.96-2.76-3.28-4.87-4.12-6.23-1.74-2.79-2.87-4.89-5.93-10.82-5.34-10.34-4.85-9.68-5.67-11-2.89-4.66-5.17-8.34-9.54-11.74-5.51-4.28-11.54-5.94-22.85-9.06-10.93-3.01-11.66-2.08-21.23-4.87-10.94-3.19-18.63-6.93-21.91-8.62-4.46-2.29-10.16-5.61-16.01-10.21Z"/></svg>
                                <svg id="material-step-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><rect class="cls-1" x="279.83" y="159.38" width="157.22" height="438.83"/><line class="cls-1" x1="377.75" y1="191.59" x2="437.15" y2="191.59"/><line class="cls-1" x1="384.5" y1="260.44" x2="435.8" y2="260.44"/><line class="cls-1" x1="378.43" y1="323.89" x2="437.82" y2="323.89"/><line class="cls-1" x1="385.18" y1="392.73" x2="436.47" y2="392.73"/><line class="cls-1" x1="377.77" y1="452.13" x2="437.17" y2="452.13"/><line class="cls-1" x1="384.52" y1="520.98" x2="435.82" y2="520.98"/></svg>
                            </div>
                        </div>
                    </div>
                    <div class="step-title">MATERIALS</div>
                    <div class="principles-description" id="material-description">Prepare materials for hand-copying, simple seals and templates.</div>
                </div>

                <div class="step-section" id="basic-principles">
                    <div class="principles-box">
                        <div class="principles-steps">
                            <div class="principles-step active" onclick="showPrinciplesStep(1, this)">PRINCIPLE 1</div>
                            <div class="principles-step" onclick="showPrinciplesStep(2, this)">PRINCIPLE 2</div>
                            <div class="principles-step" onclick="showPrinciplesStep(3, this)">PRINCIPLE 3</div>
                            <div class="principles-step" onclick="showPrinciplesStep(4, this)">PRINCIPLE 4</div>
                            <div class="principles-step" onclick="showPrinciplesStep(5, this)">PRINCIPLE 5</div>
                            <div class="principles-step" onclick="showPrinciplesStep(6, this)">PRINCIPLE 6</div>
                            <div class="principles-step" onclick="showPrinciplesStep(7, this)">PRINCIPLE 7</div>
                            <div class="principles-step" onclick="showPrinciplesStep(8, this)">PRINCIPLE 8</div>
                        </div>
                        <div class="principles-content">
                            <div class="principles-image">
                                <svg id="principle-step-1" class="active" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><line class="cls-1" x1="129.59" y1="262.23" x2="590.24" y2="353.91"/><polygon class="cls-1" points="359.92 308.18 307.91 430.71 411.93 430.71 359.92 308.18"/></svg>
                                <svg id="principle-step-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:#fff;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><circle class="cls-1" cx="194.3" cy="295.99" r="25.29"/><path class="cls-1" d="M242.57,449.21c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/><circle class="cls-1" cx="304.06" cy="295.99" r="25.29"/><path class="cls-1" d="M352.33,449.21c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/><circle class="cls-1" cx="415.94" cy="296.08" r="25.29"/><path class="cls-1" d="M464.21,449.29c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/><circle class="cls-1" cx="525.7" cy="296.08" r="25.29"/><path class="cls-1" d="M573.97,449.29c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/></svg>
                                <svg id="principle-step-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><polygon class="cls-1" points="592.26 219.7 562.09 189.53 281.08 470.54 157.91 347.37 127.74 377.54 280.67 530.47 281.08 530.06 281.49 530.47 592.26 219.7"/></svg>
                                <svg id="principle-step-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:#fff;}.cls-1,.cls-2{stroke:#000;stroke-miterlimit:10;stroke-width:4px;}.cls-2{fill:none;}</style></defs><circle class="cls-1" cx="223.5" cy="296.77" r="25.29"/><path class="cls-1" d="M271.77,449.98c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/><path class="cls-2" d="M491.91,251.68c-10.21-63.41-65.32-109.7-127.44-108.88-53.56.71-101.37,36.29-118.79,87.61"/><polygon points="237.03 224.88 241.82 244.24 256.19 230.41 237.03 224.88"/><path class="cls-2" d="M237.86,468.32c10.21,63.41,65.32,109.7,127.44,108.88,53.56-.71,101.37-36.29,118.79-87.61"/><polygon points="492.74 495.12 487.95 475.76 473.58 489.59 492.74 495.12"/><circle class="cls-1" cx="496.5" cy="296.06" r="25.29"/><path class="cls-1" d="M544.77,449.27c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/></svg>
                                <svg id="principle-step-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:#fff;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><circle class="cls-1" cx="318.85" cy="253.32" r="43.23"/><path class="cls-1" d="M401.37,515.24c-.77-109.41-37.42-197.53-82.52-197.53s-81.75,88.12-82.52,197.53h165.04Z"/><polygon class="cls-1" points="483.67 204.76 398.2 249.69 417.1 259.63 417.1 303.98 430.69 303.98 430.69 266.77 483.67 294.62 483.67 204.76"/></svg>
                                <svg id="principle-step-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:#fff;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><circle class="cls-1" cx="179.54" cy="253.32" r="43.23"/><path class="cls-1" d="M262.06,515.24c-.77-109.41-37.42-197.53-82.52-197.53s-81.75,88.12-82.52,197.53h165.04Z"/><polygon class="cls-1" points="344.36 204.76 258.88 249.69 277.79 259.63 277.79 303.98 291.38 303.98 291.38 266.77 344.36 294.62 344.36 204.76"/><circle class="cls-1" cx="540.46" cy="253.32" r="43.23"/><path class="cls-1" d="M457.94,515.24c.77-109.41,37.42-197.53,82.52-197.53s81.75,88.12,82.52,197.53h-165.04Z"/><polygon class="cls-1" points="375.64 204.76 461.12 249.69 442.21 259.63 442.21 303.98 428.62 303.98 428.62 266.77 375.64 294.62 375.64 204.76"/></svg>
                                <svg id="principle-step-7" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:#fff;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><path class="cls-1" d="M625.66,553.04c-5.81-214.71-122.52-386.08-265.66-386.08S100.15,338.33,94.34,553.04h531.32Z"/><circle class="cls-1" cx="189.3" cy="387.65" r="25.29"/><path class="cls-1" d="M237.57,540.86c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/><circle class="cls-1" cx="299.06" cy="387.65" r="25.29"/><path class="cls-1" d="M347.33,540.86c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/><circle class="cls-1" cx="410.94" cy="387.74" r="25.29"/><path class="cls-1" d="M459.22,540.95c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/><circle class="cls-1" cx="520.7" cy="387.74" r="25.29"/><path class="cls-1" d="M568.97,540.95c-.45-64-21.89-115.55-48.27-115.55s-47.82,51.55-48.27,115.55h96.54Z"/></svg>
                                <svg id="principle-step-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 720"><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:4px;}</style></defs><path class="cls-1" d="M504.91,339.72c-11.84-73.52-75.73-127.2-147.76-126.25-62.85.83-118.88,43.08-138.45,103.76"/><polygon points="210.01 311.76 214.94 331.08 229.21 317.15 210.01 311.76"/><path class="cls-1" d="M215.09,380.28c11.84,73.52,75.73,127.2,147.76,126.25,62.85-.83,118.88-43.08,138.45-103.76"/><polygon points="509.99 408.24 505.06 388.92 490.79 402.85 509.99 408.24"/></svg>
                            </div>
                        </div>
                    </div>
                    <div class="step-title">BASIC LEGAL PRINCIPLES</div>
                    <div class="principles-description" id="principle-description">EQUALITY: All community members have equal rights and responsibilities regardless of their background, skills, or resources brought to the community.</div>
                </div>

                <div class="step-section" id="resource-contract">
                    <div class="contract-template" id="resource-contract-template" onclick="toggleContract(this, event)">
                        <div class="contract-box-button" onclick="event.stopPropagation(); handleContractButtonClick(this, 'resource-contract-template', 'Resource Sharing Agreement')">
                            <svg class="print-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 6 2 18 2 18 9"></polyline>
                                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                                <rect x="6" y="14" width="12" height="8"></rect>
                            </svg>
                        </div>
                        <div class="contract-header-box">RESOURCE SHARING CONTRACT</div>
                        <div class="contract-content" onclick="event.stopPropagation()">
                            <div class="contract-header">RESOURCE SHARING CONTRACT</div>
                            <div class="contract-section">
                                <div class="contract-section-title">PARTIES</div>
                                <div class="contract-text">This agreement is entered into between the following parties:</div>
                                <div class="contract-text">Party 1: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">Party 2: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">Date: <span class="editable-field" contenteditable="true"></span></div>
                            </div>
                            <div class="contract-section">
                                <div class="contract-section-title">PURPOSE</div>
                                <div class="contract-text">The parties agree to share resources including but not limited to food, water, tools, shelter, and knowledge for mutual survival and benefit.</div>
                            </div>
                            <div class="contract-section">
                                <div class="contract-section-title">TERMS</div>
                                <div class="contract-text editable-text" contenteditable="true">1. Each party agrees to contribute resources according to their capacity and availability.</div>
                                <div class="contract-text editable-text" contenteditable="true">2. Resources will be distributed based on need, contribution, and agreed-upon ratios.</div>
                                <div class="contract-text editable-text" contenteditable="true">3. All parties have equal access to shared resources unless otherwise specified.</div>
                                <div class="contract-text editable-text" contenteditable="true">4. Decisions regarding resource allocation will be made by consensus or majority vote.</div>
                                <div class="contract-text editable-text" contenteditable="true">5. Violations of this agreement may result in exclusion from resource sharing.</div>
                            </div>
                            <div class="contract-section">
                                <div class="contract-section-title">DURATION</div>
                                <div class="contract-text">This agreement remains in effect until terminated by mutual consent or violation of terms.</div>
                            </div>
                            <div class="contract-section">
                                <div class="contract-section-title">SIGNATURES</div>
                                <div class="contract-text">Party 1: <span class="editable-field" contenteditable="true"></span> Date: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">Party 2: <span class="editable-field" contenteditable="true"></span> Date: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">Witness: <span class="editable-field" contenteditable="true"></span> Date: <span class="editable-field" contenteditable="true"></span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="step-section" id="labor-contract">
                    <div class="contract-template" id="labor-contract-template" onclick="toggleContract(this, event)">
                        <div class="contract-box-button" onclick="event.stopPropagation(); handleContractButtonClick(this, 'labor-contract-template', 'Labor Exchange Agreement')">
                            <svg class="print-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 6 2 18 2 18 9"></polyline>
                                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                                <rect x="6" y="14" width="12" height="8"></rect>
                            </svg>
                        </div>
                        <div class="contract-header-box">LABOR EXCHANGE CONTRACT</div>
                        <div class="contract-content" onclick="event.stopPropagation()">
                            <div class="contract-header">LABOR EXCHANGE CONTRACT</div>
                            <div class="contract-section">
                                <div class="contract-section-title">PARTIES</div>
                                <div class="contract-text">Provider: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">Recipient: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">Date: <span class="editable-field" contenteditable="true"></span></div>
                            </div>
                            <div class="contract-section">
                                <div class="contract-section-title">SERVICES</div>
                                <div class="contract-text">Provider agrees to perform the following services: <span class="editable-text" contenteditable="true"></span></div>
                                <div class="contract-text">Recipient agrees to provide the following compensation: <span class="editable-text" contenteditable="true"></span></div>
                            </div>
                            <div class="contract-section">
                                <div class="contract-section-title">TERMS</div>
                                <div class="contract-text">1. Work will be completed by: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">2. Compensation will be provided: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">3. Quality standards: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">4. Either party may terminate this agreement with 24 hours notice.</div>
                            </div>
                            <div class="contract-section">
                                <div class="contract-section-title">SIGNATURES</div>
                                <div class="contract-text">Provider: <span class="editable-field" contenteditable="true"></span> Date: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">Recipient: <span class="editable-field" contenteditable="true"></span> Date: <span class="editable-field" contenteditable="true"></span></div>
                                <div class="contract-text">Witness: <span class="editable-field" contenteditable="true"></span> Date: <span class="editable-field" contenteditable="true"></span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="step-section" id="community-governance">
                    <div class="document-box">
                        <div class="document-title">COMMUNITY GOVERNANCE</div>
                        <div class="document-content">DECISION-MAKING PROCESS:

1. GENERAL ASSEMBLY: All community members meet regularly (weekly or as needed) to discuss issues and make decisions.

2. VOTING: Decisions are made by majority vote. Each adult member has one vote. For critical decisions, a two-thirds majority may be required.

3. LEADERSHIP ROLES:
   - Coordinator: Organizes meetings and ensures decisions are implemented
   - Resource Manager: Tracks and allocates shared resources
   - Conflict Mediator: Helps resolve disputes
   - Security Coordinator: Organizes defense and safety measures

4. TERM LIMITS: Leadership positions rotate every 6-12 months to prevent abuse of power.

5. EMERGENCY POWERS: In emergencies, temporary authority may be granted to specific individuals, but must be reviewed by the community within 48 hours.

6. APPEALS PROCESS: Any member may appeal a decision or action to the full community assembly.</div>
                    </div>
                </div>

                <div class="step-section" id="conflict-resolution">
                    <div class="document-box">
                        <div class="document-title">CONFLICT RESOLUTION</div>
                        <div class="document-content">STEP 1: DIRECT NEGOTIATION
Parties in conflict should first attempt to resolve the issue through direct discussion.

STEP 2: MEDIATION
If direct negotiation fails, parties may request mediation by a neutral third party or community mediator.

STEP 3: ARBITRATION
If mediation fails, parties may agree to binding arbitration by a panel of three neutral community members.

STEP 4: COMMUNITY ASSEMBLY
For serious disputes or when other methods fail, the matter may be brought before the full community assembly for decision.

STEP 5: SANCTIONS
Possible sanctions for violations include:
- Public apology
- Temporary loss of privileges
- Required community service
- Exclusion from specific resources or activities
- Community expulsion (only for serious, repeated violations)

All sanctions must be proportional to the violation and approved by community consensus.</div>
                    </div>
                </div>

                <div class="step-section" id="property-rights">
                    <div class="document-box">
                        <div class="document-title">PROPERTY AND RESOURCE RIGHTS</div>
                        <div class="document-content">PERSONAL PROPERTY:
- Items brought to the community or personally created remain the property of the individual
- Personal property may not be taken without consent
- Personal property may be voluntarily shared or traded

COMMUNAL PROPERTY:
- Resources acquired collectively belong to the community
- All members have equal rights to use communal property
- Decisions about communal property require community approval

LAND AND STRUCTURES:
- Land use rights are determined by community agreement
- Structures built on community land may be personal or communal based on agreement
- Abandoned property reverts to community ownership after 30 days of absence

RESOURCE EXTRACTION:
- Natural resources (water, wood, stone) are community property
- Extraction requires community approval or established rules
- Sustainable practices must be followed</div>
                    </div>
                </div>
            </div>

            <!-- Step Navigation Panel -->
            <div class="step-navigation" id="step-navigation">
                <div class="step-nav-item" onclick="backToGrid()">
                    <div class="step-nav-close"></div>
                </div>
                <div class="step-nav-item active" data-step="introduction" onclick="scrollToStep('introduction')">
                    <div class="legend-dot"></div>
                    <div class="legend-text">INTRODUCTION</div>
                </div>
                <div class="step-nav-item" data-step="materials" onclick="scrollToStep('materials')">
                    <div class="legend-dot"></div>
                    <div class="legend-text">MATERIALS</div>
                </div>
                <div class="step-nav-item" data-step="basic-principles" onclick="scrollToStep('basic-principles')">
                    <div class="legend-dot"></div>
                    <div class="legend-text">BASIC PRINCIPLES</div>
                </div>
                <div class="step-nav-item" data-step="resource-contract" onclick="scrollToStep('resource-contract')">
                    <div class="legend-dot"></div>
                    <div class="legend-text">RESOURCE CONTRACT</div>
                </div>
                <div class="step-nav-item" data-step="labor-contract" onclick="scrollToStep('labor-contract')">
                    <div class="legend-dot"></div>
                    <div class="legend-text">LABOR CONTRACT</div>
                </div>
                <div class="step-nav-item" data-step="community-governance" onclick="scrollToStep('community-governance')">
                    <div class="legend-dot"></div>
                    <div class="legend-text">GOVERNANCE</div>
                </div>
                <div class="step-nav-item" data-step="conflict-resolution" onclick="scrollToStep('conflict-resolution')">
                    <div class="legend-dot"></div>
                    <div class="legend-text">CONFLICT</div>
                </div>
                <div class="step-nav-item" data-step="property-rights" onclick="scrollToStep('property-rights')">
                    <div class="legend-dot"></div>
                    <div class="legend-text">PROPERTY RIGHTS</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Scroll to step function
        function scrollToStep(stepId) {
            const stepElement = document.getElementById(stepId);
            if (stepElement) {
                // Get the navigation panel top position (80px)
                const navTop = 80;
                // Get the element's position relative to the document
                const elementTop = stepElement.offsetTop;
                // Calculate scroll position to align element top with navigation top
                const scrollPosition = elementTop - navTop;
                
                // Smooth scroll to the calculated position
                window.scrollTo({
                    top: scrollPosition,
                    behavior: 'smooth'
                });
                
                // Update active state
                document.querySelectorAll('.step-nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-step') === stepId) {
                        item.classList.add('active');
                    }
                });
            }
        }

        // Back to grid function (goes back to seedarchive.html)
        function backToGrid() {
            window.location.href = 'seedarchive.html';
        }

        // Toggle contract expand/collapse
        function handleContractButtonClick(button, templateId, fileName) {
            // Always print when clicking the button, regardless of expanded/collapsed state
            printContract(templateId, fileName);
        }

        function toggleContract(element, event) {
            // If event is provided, check if the click was on content that shouldn't trigger toggle
            if (event) {
                const target = event.target;
                // Don't toggle if clicking on:
                // 1. Editable fields or their containers
                // 2. Contract content area (when expanded)
                // 3. Any element inside contract-content
                if (target.hasAttribute('contenteditable') || 
                    target.closest('[contenteditable="true"]') ||
                    target.closest('.editable-field') ||
                    target.closest('.editable-text') ||
                    target.closest('.contract-content') ||
                    target.closest('.contract-section') ||
                    target.closest('.contract-text') ||
                    target.closest('.contract-header') ||
                    target.closest('.contract-section-title')) {
                    return; // Don't toggle when clicking on contract content
                }
                // Only toggle if clicking on the template itself, header box, or empty space
                // (not on contract-content or any interactive elements)
            }
            element.classList.toggle('expanded');
        }

        // Print contract function
        function printContract(templateId, fileName) {
            // Check if html2pdf is loaded
            if (typeof html2pdf === 'undefined') {
                alert('PDF生成库未加载，请刷新页面重试');
                return;
            }

            const element = document.getElementById(templateId);
            if (!element) {
                alert('找不到合同模板');
                return;
            }

            // Check if element has content
            if (!element.innerHTML || element.innerHTML.trim() === '') {
                alert('合同内容为空');
                return;
            }

            // If collapsed, expand it first for printing
            const wasCollapsed = !element.classList.contains('expanded');
            if (wasCollapsed) {
                element.classList.add('expanded');
                // Wait a bit for the expansion to render
                setTimeout(() => {
                    proceedWithPrint();
                }, 200);
            } else {
                proceedWithPrint();
            }

            function proceedWithPrint() {
                // Get the contract content element (the actual content to print)
                const contractContent = element.querySelector('.contract-content');
                if (!contractContent) {
                    alert('找不到合同内容');
                    return;
                }

                // Debug: Check if content has text
                console.log('Contract content:', contractContent);
                console.log('Contract content text:', contractContent.innerText);
                console.log('Contract content HTML:', contractContent.innerHTML.substring(0, 200));

                // Store original styles
                const originalStyles = {
                    opacity: contractContent.style.opacity,
                    visibility: contractContent.style.visibility,
                    position: contractContent.style.position,
                    top: contractContent.style.top,
                    left: contractContent.style.left,
                    width: contractContent.style.width,
                    height: contractContent.style.height,
                    color: contractContent.style.color
                };

                // Hide button and header
                const contractButton = element.querySelector('.contract-box-button');
                const contractHeaderBox = element.querySelector('.contract-header-box');
                if (contractButton) contractButton.style.display = 'none';
                if (contractHeaderBox) contractHeaderBox.style.display = 'none';

                // Force contract content to be fully visible
                contractContent.style.opacity = '1';
                contractContent.style.visibility = 'visible';
                contractContent.style.position = 'relative';
                contractContent.style.top = '0';
                contractContent.style.left = '0';
                contractContent.style.width = '100%';
                contractContent.style.height = 'auto';
                contractContent.style.color = '#000000';
                contractContent.style.backgroundColor = '#ffffff';
                contractContent.style.padding = '20px';
                contractContent.style.display = 'block';

                // Remove contenteditable and ensure all text is visible
                const allEditable = contractContent.querySelectorAll('[contenteditable="true"]');
                allEditable.forEach(el => {
                    el.removeAttribute('contenteditable');
                    el.style.color = '#000000';
                    el.style.opacity = '1';
                });

                // Remove underlines from editable fields
                const editableFields = contractContent.querySelectorAll('.editable-field, .editable-text');
                editableFields.forEach(field => {
                    field.style.borderBottom = 'none';
                    field.style.minWidth = 'auto';
                    field.style.color = '#000000';
                });

                // Scroll into view
                contractContent.scrollIntoView({ behavior: 'instant', block: 'start' });

                // Create a simple print container with clean HTML
                const printDiv = document.createElement('div');
                printDiv.style.position = 'absolute';
                printDiv.style.left = '0';
                printDiv.style.top = '0';
                printDiv.style.width = '800px';
                printDiv.style.padding = '20px';
                printDiv.style.backgroundColor = '#ffffff';
                printDiv.style.color = '#000000';
                printDiv.style.fontSize = '16px';
                printDiv.style.fontFamily = 'Arial, sans-serif';
                printDiv.style.lineHeight = '1.8';
                
                // Copy the innerHTML but clean it up
                let cleanHTML = contractContent.innerHTML;
                // Remove contenteditable attributes
                cleanHTML = cleanHTML.replace(/contenteditable="true"/g, '');
                // Remove border-bottom styles from editable fields
                cleanHTML = cleanHTML.replace(/border-bottom:\s*1px solid #000/g, '');
                
                printDiv.innerHTML = cleanHTML;
                
                // Make all text black and visible
                const allElements = printDiv.querySelectorAll('*');
                allElements.forEach(el => {
                    el.style.color = '#000000';
                    el.style.opacity = '1';
                    el.style.visibility = 'visible';
                });
                
                // Remove underlines from editable fields
                const printEditableFields = printDiv.querySelectorAll('.editable-field, .editable-text');
                printEditableFields.forEach(field => {
                    field.style.borderBottom = 'none';
                });
                
                document.body.appendChild(printDiv);

                // Wait for rendering
                setTimeout(() => {
                    // Make sure the div is visible on screen for html2canvas
                    printDiv.style.position = 'fixed';
                    printDiv.style.left = '0';
                    printDiv.style.top = '0';
                    printDiv.style.zIndex = '99999';
                    printDiv.style.display = 'block';
                    printDiv.style.visibility = 'visible';
                    printDiv.style.opacity = '1';
                    
                    // Force a reflow to ensure rendering
                    const height = printDiv.offsetHeight;
                    const width = printDiv.offsetWidth;
                    console.log('Print div dimensions:', width, height);
                    console.log('Print div has content:', printDiv.innerText.length > 0);
                    
                    // Wait a bit more for full rendering
                    setTimeout(() => {
                        // Configure options
                        const opt = {
                            margin: [10, 10, 10, 10],
                            filename: fileName + '.pdf',
                            image: { type: 'jpeg', quality: 0.98 },
                            html2canvas: { 
                                scale: 2,
                                useCORS: true,
                                logging: true,
                                backgroundColor: '#ffffff',
                                allowTaint: true,
                                removeContainer: false,
                                width: width || 800,
                                height: height || 1000,
                                x: 0,
                                y: 0,
                                scrollX: 0,
                                scrollY: 0,
                                windowWidth: width || 800,
                                windowHeight: height || 1000
                            },
                            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                        };

                        // Generate PDF from the clean print div
                        html2pdf().set(opt).from(printDiv).save().then(() => {
                            // Remove print div
                            if (printDiv.parentNode) {
                                document.body.removeChild(printDiv);
                            }
                        // Restore original styles
                        contractContent.style.opacity = originalStyles.opacity || '';
                        contractContent.style.visibility = originalStyles.visibility || '';
                        contractContent.style.position = originalStyles.position || '';
                        contractContent.style.top = originalStyles.top || '';
                        contractContent.style.left = originalStyles.left || '';
                        contractContent.style.width = originalStyles.width || '';
                        contractContent.style.height = originalStyles.height || '';
                        contractContent.style.color = originalStyles.color || '';
                        contractContent.style.backgroundColor = '';
                        contractContent.style.padding = '';
                        contractContent.style.display = '';

                        // Restore button and header
                        if (contractButton) contractButton.style.display = '';
                        if (contractHeaderBox) contractHeaderBox.style.display = '';

                        // Restore contenteditable
                        allEditable.forEach(el => {
                            el.setAttribute('contenteditable', 'true');
                        });

                        element.classList.remove('print-mode');
                        if (wasCollapsed) {
                            element.classList.remove('expanded');
                        }
                            console.log('PDF generated successfully');
                        }).catch((error) => {
                            console.error('PDF generation error:', error);
                            // Remove print div
                            if (printDiv.parentNode) {
                                document.body.removeChild(printDiv);
                            }
                        // Restore everything on error
                        contractContent.style.opacity = originalStyles.opacity || '';
                        contractContent.style.visibility = originalStyles.visibility || '';
                        contractContent.style.position = originalStyles.position || '';
                        contractContent.style.top = originalStyles.top || '';
                        contractContent.style.left = originalStyles.left || '';
                        contractContent.style.width = originalStyles.width || '';
                        contractContent.style.height = originalStyles.height || '';
                        contractContent.style.color = originalStyles.color || '';
                        contractContent.style.backgroundColor = '';
                        contractContent.style.padding = '';
                        contractContent.style.display = '';
                        if (contractButton) contractButton.style.display = '';
                        if (contractHeaderBox) contractHeaderBox.style.display = '';
                        allEditable.forEach(el => {
                            el.setAttribute('contenteditable', 'true');
                        });
                        element.classList.remove('print-mode');
                        if (wasCollapsed) {
                            element.classList.remove('expanded');
                        }
                            alert('PDF生成失败: ' + error.message);
                        });
                    }, 200); // Additional delay for rendering
                }, 300);
            }
        }

        // Materials step function
        function showMaterialsStep(stepNumber, element) {
            // Hide all SVGs
            document.querySelectorAll('#material-step-1, #material-step-2, #material-step-3, #material-step-4, #material-step-5').forEach(svg => {
                svg.classList.remove('active');
            });
            
            // Show selected SVG
            const selectedSvg = document.getElementById('material-step-' + stepNumber);
            if (selectedSvg) {
                selectedSvg.classList.add('active');
            }
            
            // Update active step
            const stepButtons = document.querySelectorAll('#materials .principles-step');
            stepButtons.forEach(step => {
                step.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            } else {
                if (stepButtons[stepNumber - 1]) {
                    stepButtons[stepNumber - 1].classList.add('active');
                }
            }
            
            // Update description
            const descriptions = [
                'Prepare materials for hand-copying, simple seals and templates.',
                'Fixed venues for assemblies, arbitrations and public announcements.',
                'List of trusted community members.',
                'Boundary markers, ownership marks, seals or stamps.',
                'Waterproof and fireproof storage containers, multiple copy storage locations.'
            ];
            const descriptionEl = document.getElementById('material-description');
            if (descriptionEl) {
                descriptionEl.textContent = descriptions[stepNumber - 1];
            }
        }

        // Get current material step number
        function getCurrentMaterialStep() {
            const activeSvg = document.querySelector('#materials .principles-image svg.active');
            if (activeSvg) {
                const id = activeSvg.id;
                const match = id.match(/material-step-(\d+)/);
                if (match) {
                    return parseInt(match[1]);
                }
            }
            return 1; // Default to step 1
        }

        // Go to next step when clicking on image
        function nextMaterialStep() {
            const currentStep = getCurrentMaterialStep();
            const nextStep = currentStep < 5 ? currentStep + 1 : 1; // Loop back to step 1 after step 5
            const stepButtons = document.querySelectorAll('#materials .principles-step');
            const nextElement = stepButtons[nextStep - 1];
            showMaterialsStep(nextStep, nextElement);
        }

        // Principles step function
        function showPrinciplesStep(stepNumber, element) {
            // Hide all SVGs
            document.querySelectorAll('#principle-step-1, #principle-step-2, #principle-step-3, #principle-step-4, #principle-step-5, #principle-step-6, #principle-step-7, #principle-step-8').forEach(svg => {
                svg.classList.remove('active');
            });
            
            // Show selected SVG
            const selectedSvg = document.getElementById('principle-step-' + stepNumber);
            if (selectedSvg) {
                selectedSvg.classList.add('active');
            }
            
            // Update active step
            const stepButtons = document.querySelectorAll('#basic-principles .principles-step');
            stepButtons.forEach(step => {
                step.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            } else {
                if (stepButtons[stepNumber - 1]) {
                    stepButtons[stepNumber - 1].classList.add('active');
                }
            }
            
            // Update description
            const descriptions = [
                'EQUALITY: All community members have equal rights and responsibilities regardless of their background, skills, or resources brought to the community.',
                'FAIRNESS: Resources and labor should be distributed fairly based on contribution, need, and capacity.',
                'CONSENT: No individual may be forced into agreements or actions without their informed consent.',
                'ACCOUNTABILITY: All members are accountable for their actions and must face consequences for violations of community rules.',
                'TRANSPARENCY: Decisions affecting the community must be made transparently and with opportunity for input from all members.',
                'RESOLUTION: Disputes should be resolved through mediation, arbitration, or community consensus rather than violence.',
                'PROTECTION: The community has a duty to protect vulnerable members including children, elderly, and those unable to work.',
                'SUSTAINABILITY: Laws and agreements must consider long-term survival and resource conservation.'
            ];
            const descriptionEl = document.getElementById('principle-description');
            if (descriptionEl) {
                descriptionEl.textContent = descriptions[stepNumber - 1];
            }
        }

        // Get current principle step number
        function getCurrentPrincipleStep() {
            const activeSvg = document.querySelector('#basic-principles .principles-image svg.active');
            if (activeSvg) {
                const id = activeSvg.id;
                const match = id.match(/principle-step-(\d+)/);
                if (match) {
                    return parseInt(match[1]);
                }
            }
            return 1; // Default to step 1
        }

        // Go to next step when clicking on image
        function nextPrincipleStep() {
            const currentStep = getCurrentPrincipleStep();
            const nextStep = currentStep < 8 ? currentStep + 1 : 1; // Loop back to step 1 after step 8
            const stepButtons = document.querySelectorAll('#basic-principles .principles-step');
            const nextElement = stepButtons[nextStep - 1];
            showPrinciplesStep(nextStep, nextElement);
        }

        // Contract step function
        function showContractStep(stepNumber, element) {
            // Hide all SVGs
            document.querySelectorAll('#contract-step-1, #contract-step-2, #contract-step-3, #contract-step-4, #contract-step-5').forEach(svg => {
                svg.classList.remove('active');
            });
            
            // Show selected SVG
            const selectedSvg = document.getElementById('contract-step-' + stepNumber);
            if (selectedSvg) {
                selectedSvg.classList.add('active');
            }
            
            // Update active step
            const stepButtons = document.querySelectorAll('#resource-contract .principles-step');
            stepButtons.forEach(step => {
                step.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            } else {
                if (stepButtons[stepNumber - 1]) {
                    stepButtons[stepNumber - 1].classList.add('active');
                }
            }
            
            // Update description
            const descriptions = [
                'PARTIES: This agreement is entered into between the following parties: Party 1: [Name], Party 2: [Name], Date: [Date]',
                'PURPOSE: The parties agree to share resources including but not limited to food, water, tools, shelter, and knowledge for mutual survival and benefit.',
                'TERMS: Each party agrees to contribute resources according to their capacity and availability. Resources will be distributed based on need, contribution, and agreed-upon ratios. All parties have equal access to shared resources unless otherwise specified.',
                'DURATION: This agreement remains in effect until terminated by mutual consent or violation of terms.',
                'SIGNATURES: Party 1: _________________ Date: _______, Party 2: _________________ Date: _______, Witness: _________________ Date: _______'
            ];
            const descriptionEl = document.getElementById('contract-description');
            if (descriptionEl) {
                descriptionEl.textContent = descriptions[stepNumber - 1];
            }
        }

        // Get current contract step number
        function getCurrentContractStep() {
            const activeSvg = document.querySelector('#resource-contract .principles-image svg.active');
            if (activeSvg) {
                const id = activeSvg.id;
                const match = id.match(/contract-step-(\d+)/);
                if (match) {
                    return parseInt(match[1]);
                }
            }
            return 1; // Default to step 1
        }

        // Go to next step when clicking on image
        function nextContractStep() {
            const currentStep = getCurrentContractStep();
            const nextStep = currentStep < 5 ? currentStep + 1 : 1; // Loop back to step 1 after step 5
            const stepButtons = document.querySelectorAll('#resource-contract .principles-step');
            const nextElement = stepButtons[nextStep - 1];
            showContractStep(nextStep, nextElement);
        }

        // Function to update active nav item based on scroll position
        function updateActiveNavItem() {
            const sections = ['introduction', 'materials', 'basic-principles', 'resource-contract', 'labor-contract', 'community-governance', 'conflict-resolution', 'property-rights'];
            const scrollPosition = window.scrollY + window.innerHeight / 2;
            
            let activeSection = null;
            
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    const sectionTop = section.offsetTop;
                    const sectionBottom = sectionTop + section.offsetHeight;
                    
                    if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                        activeSection = sectionId;
                    }
                }
            });
            
            // Update navigation items
            document.querySelectorAll('.step-nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-step') === activeSection) {
                    item.classList.add('active');
                }
            });
        }

        // Add click events to image containers
        document.addEventListener('DOMContentLoaded', function() {
            const materialsImageContainer = document.querySelector('#materials .principles-image');
            if (materialsImageContainer) {
                materialsImageContainer.addEventListener('click', nextMaterialStep);
            }
            
            const principlesImageContainer = document.querySelector('#basic-principles .principles-image');
            if (principlesImageContainer) {
                principlesImageContainer.addEventListener('click', nextPrincipleStep);
            }
            
            const contractImageContainer = document.querySelector('#resource-contract .principles-image');
            if (contractImageContainer) {
                contractImageContainer.addEventListener('click', nextContractStep);
            }
            
            // Add scroll listener to update active nav item
            window.addEventListener('scroll', updateActiveNavItem);
            // Initial check
            updateActiveNavItem();
        });
    </script>
</body>
</html>
